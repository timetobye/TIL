Transaction
----

## 문서 목적
Transaction(이하 트랜잭션)에 대해 정리하기 위한 문서 입니다.

## 정의
트랜잭션이란?
- 데이터베이스에서 데이터에 대한 하나의 논리적 실행단계를 트랜잭션
- 데이터베이스 트랜잭션(Database Transaction)은 데이터베이스 관리 시스템 또는 유사한 시스템에서 상호작용의 단위
- 유사한 시스템이란 트랜잭션이 성공과 실패가 분명하고 상호 독립적이며, 일관되고 믿을 수 있는 시스템을 의미

트랜잭션의 목적?
- 트랜잭션을 조작하는 기능은 사용자가 데이터베이스 완전성(integrity) 유지를 확신하게 한다.
- 단일 트랜잭션은 데이터베이스 내에 읽거나 쓰는 여러 개 쿼리를 요구한다 이때 중요한 것은 데이터베이스가 수행된 일부 쿼리가 남지 않는 것이다. 
예를 들면, 송금을 할 때 한 계좌에서 인출되면 다른 계좌에서 입금이 확인되는 것이 중요하다. 또한 트랜잭션은 서로 간섭하지 않아야 한다.

간단한 트랜잭션은 아래 양식의 SQL 언어로 데이터베이스 내에서 실행
- Begin the transaction
- Execute several queries (DB내 갱신이 아직 적용되지 않는다)
- Commit the transaction (트랜잭션이 성공적이며, 갱신이 실제 적용됨)

만약 쿼리 하나가 실패하면, 데이터베이스 시스템은 전체 트랜잭션 또는 실패한 쿼리를 롤백
이것은 DBMS가 어떻게 사용되고 셋업 되었느냐에 따라 다르다. 트랜잭션은 커밋전에 언제든지 수동으로 롤백될 수 있다

데이터베이스 시스템은 각각의 트랜잭션에 대해 다음의 성질을 지닌다. 아래 성질을 첫글자를 따 ACID라 부른다.
- 원자성(Atomicity)
- 일관성(Consistency)
- 독립성(Isolation)
- 영구성(Durability)

데이터베이스 트랜잭션이 안전하게 수행된다는 것을 보장하기 위한 성질을 가리키는 약어

자료 출처 - [데이터베이스 트랜잭션](https://ko.wikipedia.org/wiki/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4_%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98)

은행에서의 계좌이체를 트랜잭션이라고 할 수 있다
- 계좌이체 자체의 구현은 내부적으로 여러 단계로 이루어질 수 있지만 전체적으로는 
'송신자 계좌의 금액 감소', '수신자 계좌의 금액 증가'가 한 동작으로 이루어져야 하는 것을 의미한다.

![alt text](https://www.guru99.com/images/1/100518_0500_DBMSTransac6.png)

### 트랜잭션의 성질

원자성(Atomicity)
- 트랜잭션과 관련된 작업들이 부분적으로 실행되다가 중단되지 않는 것을 보장하는 능력
- 예를 들어, 자금 이체는 성공할 수도 실패할 수도 있지만 보내는 쪽에서 돈을 빼 오는 작업만 성공하고 
받는 쪽에 돈을 넣는 작업을 실패해서는 안된다. 원자성은 이와 같이 중간 단계까지 실행되고 실패하는 일이 없도록 하는 것이다.
- 트랜잭션의 연산은 데이터베이스에 모두 반영되거나, 전혀 반영되지 않아야 한다.
- 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 함. 또는 오류가 나면 트랜잭션 전부 취소되어야 함

일관성(Consistency)
- 트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 유지하는 것을 의미
- 무결성 제약이 모든 계좌는 잔고가 있어야 한다면 이를 위반하는 트랜잭션은 중단

독립성(Isolation)
- 트랜잭션을 수행 시 다른 트랜잭션의 연산 작업이 끼어들지 못하도록 보장하는 것을 의미한다. 
- 이것은 트랜잭션 밖에 있는 어떤 연산도 중간 단계의 데이터를 볼 수 없음을 의미한다. 
- 은행 관리자는 이체 작업을 하는 도중에 쿼리를 실행하더라도 특정 계좌간 이체하는 양 쪽을 볼 수 없다. 
- 공식적으로 고립성은 트랜잭션 실행내역은 연속적이어야 함을 의미한다. 
- 성능관련 이유로 인해 이 특성은 가장 유연성 있는 제약 조건이다.

지속성(Durability)
- 성공적으로 수행된 트랜잭션은 영원히 반영되어야 함을 의미
- 시스템 문제, DB 일관성 체크 등을 하더라도 유지되어야 함을 의미
- 전형적으로 모든 트랜잭션은 로그로 남고 시스템 장애 발생 전 상태로 되돌릴 수 있다. 
- 트랜잭션은 로그에 모든 것이 저장된 후에만 commit 상태로 간주될 수 있다.

자료 출처
- [트랜잭션 ACID](https://ko.wikipedia.org/wiki/ACID)
- [트랜잭션이란 무엇인가?](https://coding-factory.tistory.com/226)
- [트랜잭션이란?](https://mommoo.tistory.com/62)


### Commit, Rollback 연산
**Commit**
- Commit이란 하나의 트랜잭션이 성공적으로 끝났고, 데이터베이스가 일관성있는 상태에 있을 때, 
하나의 트랜잭션이 끝났다라는 것을 알려주기위해 사용하는 연산
- 트랜잭션이 로그에 저장되며, 후에 Rollback 연산을 수행했었던 트랜잭션단위로 하는것을 도와준다.

**Rollback**
- Rollback이란 하나의 트랜잭션 처리가 비정상적으로 종료되어 트랜잭션의 원자성이 깨진경우, 
트랜잭션을 처음부터 다시 시작하거나, 트랜잭션의 부분적으로만 연산된 결과를 다시 취소 시킨다.
- 사용자가 트랜잭션 처리된 단위대로 Rollback을 진행 가능