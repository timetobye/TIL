A/B 테스트 기법
----

## 문서 목적
A/B 테스트 기법 강의를 수강 후 내용 정리하기 위한 문서

## 강의 개요
- 강의 링크 : https://tacademy.skplanet.com/live/player/onlineLectureDetail.action?seq=160
- 학습 내용
  - A/B테스트의 기본 개념 및 배경, 적용 사례에 대해 알아본다.
  - A/B테스트 설계과정 및 결과 평가방법, 실무 적용시 주의점 등에 대해 알아본다.
- 강사 : 권정민 데이터분석가

----------

## 1강. A/B 테스트란

### A/B 테스트란
A/B 테스팅이란 임의로 나눈 두 집단에게 서로 달느 컨텐츠를 제시한 후 두 집단 중 어떤 집단이 더 높은 성과를 보이는지 정량적으로 
평가하는 방식
- '무작위 비교 연구'라 불리는 방법을 서비스에 적용한 방법
- 실무쪽에서 다루는 기술이나 방법론도 용어 등이 변경된 것이라서 기존에 연구된 것을 실무에 사용한 것임

### 고객 분석을 위한 테스트
고객의 행동을 파악하고 데이터를 수집하기 위한 환경이 좋아짐

고객 분석
- 종단적 연구
  - 고객들이 사용한 정도에 따라서 분석하는 방법 
  - 코호트 분석 : 사람이 사용한 정도에 따라 나누는 분석
- 횡단적 연구 : 고객군을 임의로 나누어서 군별로 어떻게 다룬지 실험
  - A/B 테스트
  - 다변량 분석
  
### 사례 소개

![alt text](./imgs/1.png)

### A/B 테스트

1. 실제 대상자를 반으로 나눈 후
2. 두 가지 포맷의 테스트 자료(버튼, 이미지 등을 바꿈)를 만들어서
3. 이를 A, B 그룹 각각에 제공
4. 이에 따라 각 그룹이 얼마나 반응했는지를 판단
5. 결과가 우수한 내용을 실전에 반영

원래 모든 것은 다 잘하기는 어렵다.
- a/b 테스트는 실무에서 고객들을 대상으로 임의로 하는거기 때문에, 대충하면 하지 않는 것만 못 하다.
- 잘, 많이, 넘어가는 것이 중요하다.

### A/B 테스트의 배경

우리는 외부 요인을 다 컨트롤 할 수는 없다.

내성성 vs. 외생성
- 내생성 : 해당 시스템 내에서 결정되거나 생성되는 것
- 외생성 : 시스템 밖의 요소로 결정되거나 생성되는 것

예를 들면, 비가 올 때 우산을 들고 나가서 장사를 하는 것 vs 비가 안 와서 장사를 망침
- 천재지변 같은 것은 외생성

사용자의 행동
- 많은 경우 여러 가지 요소가 복합적으로 작용함
  - 외생성 및 고려하는 변수의 영향으로 명확한 요인 및 원인 분석 어려움
- 많은 실제 상황(실무)의 경우 내생성을 위한 시스템을 일부 요소만으로 구축하기 어려움

상관관계는 인과관계를 나타내지 않는다
- 최대한 다른 요인을 제거함으로써 인과관계에 최대한 가까운 근거를 만들고자 함
  - 무엇을 하면 어떻게 되더라 를 만들기 위해서 하는 것이 A/B 테스트
  
~ 때문에 ~ 이다 라는 문장을 만들기가 어렵다.
- 서비스를 추가 했는데 뭐가 잘 됐다. 는 판단하기 어려움
  - 프로모션, 서비스 성장 중, 경쟁 서비스가 적다, 등등등
  - 대부분의 일들은 한 가지 요인만으로 달라지기는 어렵다.

두 집단에게 거의 동일한 시간에 화면을 다르게 보여줘서 결과를 얻음

### A/B 테스트 실제 사용 사례

![alt text](./imgs/2.png)

![alt text](./imgs/3.png)


## 2강. A/B 테스트 설계

### 실험 설계
Experimental design
- 실험 계획법 : 실험에 대한 계획방법으로, 해결하려는 문제에 대하여 실험방법, 데이터 수집, 통계분석들을
통하여 최소의 실험 횟수로부터 최대의 정보를 획득하도록 계획하는 것
- 로널드 피셔 : 유명한 통계학자

A/B 테스트
- 사용자의 반응도에 대한 실험 -> 사용자를 대상으로 한 실제 환경에서의 실험 

### 사회조사방법론에서의 실험 설계

A/B 테스트는 유사실험조사설계
- 실험환경은 최대한 세팅
- 사용자 집단을 다르게 한 뒤에, 환경이 다를 때 어떻게 하는가
- 비동일통제집단 전후비교설계 -> 약식으로 하면 A/B 테스트, 이것을 제일 많이 함
- 시계열설계, 복수시계열설계

전실험조사설계
- 외적 타당도도 무척 낮고, 실험의 근거가 없음
- 실험이라고 보기에는 좀 어려움
- 사회조사 쪽에서는 논문을 쓸 때 어쩔 수 없이 씀

![alt text](./imgs/4.png)

### 유사실험설계의 특징
- 사회 현상에서의 인과관계 판단용
  - 인과 관계를 만들고 싶어서 A/B 테스트를 하는 거임
- 순수실험설계만큼의 통제가 불가한 환경에서 대안적인 방식으로 통제 집단을 구성함
  - 감옥에 사람을 넣고 통제할 수는 없으니...
- 외생변수의 개입 가능성이 높음
  - 시계열 같은 경우는 굉장히 많이 작용
  - 주중 / 주말 접속 패턴 등 단순한 것부터....다름
- 실험에 대한 통제가 적으므로 외적 타당성이 상대적으로 높아 현실 문제 해결에 유용함

### 실험 설계 과정

1. 대상선정 : 연구대상을 선정
2. 실험환경 선정 : 실험실, 실험 도구 등의 실험 환경을 선정
3. 무작위표집 : 연구대상을 무작위로 표본추출
4. 무작위할당 : 추출된 표본을 무작위로 실험집단과 통제집단에 배치
5. 사전검사 : 두 집단에 종속변수에 대한 사전검사를 실시
6. 실험조치 : 실험집단에만 실험조치를 실시
7. 사후검사 : 두 집단에 종속변수에 대한 사후검사를 실시
8. 비교 및 검증 : 사전, 사후검사 결과 변수 간의 의미있는 변화를 비교

### A/B 테스트 실험 설계 과정

1. 대상선정 : 연구대상을 선정 -> **사용자 및 지표**
2. 실험환경 선정 : 실험실, 실험 도구 등의 실험 환경을 선정 -> 실제/실제 예정 환경(어떤 것을 변경 비교 할 것인가)
3. 무작위표집 : 연구대상을 무작위로 표본추출 -> 사용자 무작위 선정(실제 환경이기 떄문에...)
4. 무작위할당 : 추출된 표본을 무작위로 실험집단과 통제집단에 배치(난수 생성해서 홀짝으로 구분, 아이디 기준 홀짝, 가입 시간 등)
5. 사전검사 : 두 집단에 종속변수에 대한 사전검사를 실시 -> 실험 환경 확인
6. 실험조치 : 실험집단에만 실험조치를 실시 -> 분기
7. 사후검사 : 두 집단에 종속변수에 대한 사후검사를 실시 -> 실험 환경 재확인
8. 비교 및 검증 : 사전, 사후검사 결과 변수 간의 의미있는 변화를 비교 -> 결과 분석

### 목적 지표 선정
가설 검정에 가장 직관적이면서 구하기 용이한 지표 선정
- 제일 중요하고, 중요하고, 사람들이 잘...안 하는 과정 -_-;;
- 내가 이 실험을 왜 하고, 얻고자 하는 것이 중요
- 정의를 잘 내리자. 궁금한 게 너무 많아지면 본질을 까먹음...
- 예를 들어, 버튼을 바꾸면 사람들이 클릭을 더 많이 할 것이다 와 같이...직관적으로 용이한 지표 선정

양적으로 확인 가능한 실질적 지표
- 감정 정도(사용자 만족도 등) 같은 모호한 지표는 제외함
- 실험을 통해서 기록되지 않은 데이터가 필요한 수치는 제외함

비율 : 사용 흐름상 전 후
- 퍼널의 실험 참여 단계 -> 실험 결과 반응 단계
- CTR(Click-Through Rate) : 클릭 수 / 페이지 뷰 수
- A/B 테스트에서는 비율을 보는 것이 좋음
  - 버튼을 바꾸기 전에는 10000명 중 3000명이 클릭했는데, 바꾼 후에는 50000명 중 4000명이 클릭
  - 실험 중 모수가 달라질 수 있음
  - 흐름 상의 변화량을 보고자 하기 때문에 비율을 본다.

실험 대상 : 사람 -> 지표 대상도 사람이 되어야 보다 정확한 결과를 얻을 수 있음
- 예 : 클릭한 사용자 / 페이지를 본 사용자


### 지표 관련 대푯값

![alt text](./imgs/5.png)

### 지표 관련 분포
다름 사람을 이해시킬 때는 그림이 최고

![alt text](./imgs/6.png)

### 실습(1)

![alt text](./imgs/7.png)

1. 가설 : 동영상 미리 보기 버튼을 유튜브 모양으로 만들어두면 사람들이 더 많이 눌러볼 것이다.
2. 지표 : click Rate
3. A/B 테스트 : 기존의 사이트와 버튼을 변경한 사이트 둘을 50%의 확률로 랜덤하게 노출시킴(한 명의 사용자가 양쪽 화면을 다 보지 않도록 하자)
4. 기간 : 1주일
5. 지표 확인 : 7일간 일별로 클릭율을 집계한 후 각각 비교 -> 각각 비교가 어렵거나 숫자가 작을 경우 평균값 비교


### 실습(2)

![alt text](./imgs/8.png)

1. 가설 : 레벨 40의 난이도를 쉽게 하면 사용자들이 덜 이탈할 것이다.
2. 지표 : 레벨 40을 1회 플레이한 후 3일 이내 다시 게임에 접속하는 사용자 비율
3. A/B 테스트 : 레벨 40의 판을 임의로 구분한 기준에 따라 사용자(예: 사용자 번호가 끝자리 0~4까지는 기존 판, 5~9까지는 새로운 판을 제공함)에게 제공
4. 기간 : 21일
5. 지표 확인 : 일별 레벨 40을 플레이한 사용자와 그 3일 이내 재접속한 사용자의 수를 세서 그 비율을 구한다. 전체 집계를 기본으로 사용하고 일별 비교,
주별 비교를 같이 사용해서 이상치가 있는 지를 살펴본다.

## 3. A/B 테스트 실험 평가

### Q&A 세션

Q. 표본의 크기
- 실제 서비스에서 표본의 크기를 정하기 어려움
- 보통은 기존의 평균적으로 하루에 얼마나 들어오는지 감을 잡아서 대략...일주일
  - 최소 숫자를 잡고, 주말까지 포함해서 처리를 해보자
- 기본적인 지표를 확인할 떄는 하루 사용자 수로 정하면 되고, 웹페이지 같은 경우 PV(페이지뷰)수를 봐도 됨
- 내가 목표 숫자가 있으면, 목표 숫자 달성할 떄 끊는다.
- 사람이 안 들어오면....?(적게 들어올 때)
  - 신빙성이 없을 가능성이 높음
  - 통계 수치 구하는 건 무의미...-> 감으로 하시지요. 굳이 테스트보다는 ...

Q. A/B를 나누었을 때 사용자들이 완전히 동일한 사용자라고 볼 수 없다.
- 사용자들이 테스트를 하기 전에 집단의 차이가 있었는지 확인을 해주는 것이 필요
- 사용자들이 구분이 된다고 할 때(뒷자리 번호, 아이디 등...)
  - 기존의 구매율, 테스트 하기 전에 봐도 되고...
  - 테스트 후 나온 그룹을 가지고 이 사람들이 테스트 전에 어떤 행동을 했는지 확인
  - 일주일 전 후로 할 경우 A/A 테스트도 할 수 있음
  
Q. 다변량분석과 실험계획법은 다른걸로 보면 됩니다.
- 다변량분석은 A/B 테스트의 확장법으로 보면 됨

### 사용자 퍼널(Funnel)

![alt text](./imgs/9.png)

### 목표 지표의 해석

비교 전 확인
- 실험군과 대조군(A군과 B군)의 사용자 집합 크기가 동일한가?
- 실험군과 대조군의 사용자 분포가 크게 다르지 않는가?
  - 구매를 안 하는 사람들이 몰리지는 않았는지...등등 확인 필요

확인 방법
- 집합 크기가 다름 : 1대1 비교 대신 집합 크기를 통한 비교의 유의성 판단
- 분포 파악 : 성질이 다른 집합끼리의 비교는 무의미할 수 있음

유의 사항
- 실험으로 얻은 값은 항상 그와 동일한 결과를 담보하는 것이 아님
- 실험 크기가 통제가 되지 않을 경우에는 사후 추정으로 판단할 수 있음
  - 100명 중 3명 vs. 100000명 중 3000명... 비교가 유의한지 아닌지 비교
  
당연한 것을 잘 하고, 해야한다.!!!

실험으로 값을 얻지만, 실험으로 얻은 값이 실제로 4% -> 7%가 됐는데, 다음에도 7%냐?
- 그건 모름
- 동일한 결과가 완벽하게 나타나는 것은 아니라는 것을 기억하자.
- 실험 사용자 크기가 통제가 되지 않습니다.
  - 생각하고 많이 달랐다고 하더라도, 약간 두 개의 차이가 난다고 하더라도 통계적 유의성을 가져갈 수 있긴 하다.
  - 너무 심하게 다르지 않다면 천착하지 않아도 됨
  
### 이항 분포
실험을 할 때 아무거에나 실험을 막 하고, 함수를 막 쓰면 하나마나한 실험이 될 수 있다.
- 테스트를 매우 간단하게 만들면 분포를 사용하기 쉬워짐
- n=20, n=40 일 때 차이가 있음

![alt text](./imgs/10.png)




